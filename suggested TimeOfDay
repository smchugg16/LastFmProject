-- Correct Date and Time Formats
ALTER TABLE ScrobblerProject.dbo.ScrobblesUpdated
ALTER COLUMN DATE DATE;

ALTER TABLE ScrobblerProject.dbo.ScrobblesUpdated
ALTER COLUMN TIME TIME;

-- Preview Data After Format Correction
SELECT * 
FROM ScrobblerProject.dbo.ScrobblesUpdated
ORDER BY DATE DESC, TIME DESC;

-- Create Tables for Song Plays by Time of Day (UTC to EST Conversion)
WITH TimeOfDayClassification AS (
    SELECT
        Artist,
        Title,
        SongTitle,
        CASE
            WHEN DATEADD(HOUR, -5, TIME) BETWEEN '06:00' AND '11:59' THEN 'Morning'
            WHEN DATEADD(HOUR, -5, TIME) BETWEEN '12:00' AND '17:59' THEN 'Afternoon'
            WHEN DATEADD(HOUR, -5, TIME) BETWEEN '18:00' AND '23:59' THEN 'Night'
            WHEN DATEADD(HOUR, -5, TIME) BETWEEN '00:00' AND '05:59' THEN 'Late Night/Early Morning'
        END AS TimeOfDay,
        COUNT(SongTitle) AS TimeSongPlays
    FROM ScrobblerProject.dbo.ScrobblesUpdated
    GROUP BY Artist, Title, SongTitle, TimeOfDay
)

-- Morning (6am to 12pm)
SELECT Artist, Title, TimeOfDay, SUM(TimeSongPlays) AS TotalTimeSongPlays
FROM TimeOfDayClassification
WHERE TimeOfDay = 'Morning'
GROUP BY Artist, Title, TimeOfDay
ORDER BY TotalTimeSongPlays DESC;

-- Afternoon (12pm to 6pm)
SELECT Artist, Title, TimeOfDay, SUM(TimeSongPlays) AS TotalTimeSongPlays
FROM TimeOfDayClassification
WHERE TimeOfDay = 'Afternoon'
GROUP BY Artist, Title, TimeOfDay
ORDER BY TotalTimeSongPlays DESC;

-- Night (6pm to 12am)
SELECT Artist, Title, TimeOfDay, SUM(TimeSongPlays) AS TotalTimeSongPlays
FROM TimeOfDayClassification
WHERE TimeOfDay = 'Night'
GROUP BY Artist, Title, TimeOfDay
ORDER BY TotalTimeSongPlays DESC;

-- Late Night/Early Morning (12am to 6am)
SELECT Artist, Title, TimeOfDay, SUM(TimeSongPlays) AS TotalTimeSongPlays
FROM TimeOfDayClassification
WHERE TimeOfDay = 'Late Night/Early Morning'
GROUP BY Artist, Title, TimeOfDay
ORDER BY TotalTimeSongPlays DESC;
